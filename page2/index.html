<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>
    <div id="main" style="width: 1000px;height:600px;"></div>
    <script src="./echarts.js"></script>
    <script src="./jquery-1.11.3.js"></script>
    <script>

        var testX;
        var testY;

        function upDate() {
            var socket = new WebSocket('ws://localhost:8082/socketTest');
            socket.addEventListener('open', function (event) {
                console.log('socket is open')
                socket.send('连接到客户端')
            });

            socket.addEventListener('message', function (event) {
                let data = JSON.parse(event.data);
                console.log(data, testY);
                testX.push(data.time);
                testX.shift();
                testY.push(data.Lp);
                testY.shift();
                myChart.setOption({
                    title: {
                        text: data.Lp + 'dB'
                    },
                    xAxis: {
                        data: testX
                    },
                    series: [{
                        name: 'Lp',
                        data: testY
                    }]
                });
            });
        }

        var myChart = echarts.init(document.getElementById('main'));
        echarts.init(document.getElementById('main'));
        $.ajax({
            url: '/data',
            type: 'get',
            success(msg) {
                msg = msg.reverse();
                testY = msg.map(item => {
                    var temp = item.Lp;
                    return temp;
                });
                testX = msg.map(item => {
                    var temp = item.time;
                    return temp;
                })
                myChart.setOption({
                    title: {
                        text: 'ECharts'
                    },
                    xAxis: {
                        type: "category",
                        boundaryGap: false,
                        data: testX
                    },
                    yAxis: {
                        boundaryGap: [0, '100%'],
                        type: 'value'
                    },
                    series: [{
                        name: 'Lp',
                        type: 'line',
                        smooth: true, //数据光滑过度
                        symbol: 'none', //下一个数据点
                        stack: 'a',
                        areaStyle: {
                            normal: {
                                color: 'red'
                            }
                        },
                        data: testY
                    }]
                })
                upDate();
            }
        })

    </script>
</body>

</html>